#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customizations:

# Aliases
alias zshconfig="${VISUAL} ${ZDOTDIR:-$HOME}/.zprezto"
alias grm="git ls-files -z --deleted | xargs -0r git rm" # git rm files that are manually deleted
alias reload!='. $HOME/.zshrc'
alias rand='openssl rand -base64 10'
alias reconfig!='$HOME/Dropbox/Config/bootstrap.sh'
alias disableairdrop='sudo ifconfig awdl0 down'
alias quickspecs="be rspec --tag '~integration'"
alias spec='be rspec --no-profile --color --format documentation'

# Fleet and Etcd aliases
alias fc='fleetctl'
alias ec='etcdctl'
alias fcl='fleetctl list-units'
alias fcm='fleetctl list-machines'
alias fcj='fleetctl journal'

# disable completion
alias atom='nocorrect atom'

# Not everything should be on github...
if [[ -s ${ZDOTDIR:-$HOME}/.zprivatenv ]]; then
  source ${ZDOTDIR:-$HOME}/.zprivatenv
fi

# Alias git to the hub command if installed
if which hub > /dev/null; then alias git="hub"; fi

# Don't autocorrect me
unsetopt correct_all

# pasting with tabs doesn't perform completion
zstyle ':completion:*' insert-tab pending

# rbenv
# TODO: switch to chruby or otherwise stop rbenv path being inserted at head of path before chefdk
if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi

# autocomplete ssh based on ~/.ssh/config
hosts=$(awk '/^Host / {printf("%s ",$2)}' ~/.ssh/config 2>/dev/null)
zstyle ':completion:*:hosts' hosts '$hosts'

# show completion menu when number of options is at least 2
zstyle ':completion:*' menu select=2


# Travis gem autocomplete
if [[ -s "${ZDOTDIR:-$HOME}/.travis/travis.sh" ]]; then
  source "${ZDOTDIR:-$HOME}/.travis/travis.sh"
fi

# Named directories
#ops="$HOME/projects/dna-ops"
#: ~ops

# Functions

berks-open () {
  local _editor
  _editor="${VISUAL:-$EDITOR}"
  if [[ -n $1 ]]; then
    echo "opening cookbook $1 with $_editor"
    $_editor $(berks show $1)
  else
    echo "error - usage: berks-open COOKBOOK"
    exit(1)
  fi
}
alias bo='berks-open'

# Travis cli auto-complete
[ -f "$HOME/.travis/travis.sh" ] && source "$HOME/.travis/travis.sh"
